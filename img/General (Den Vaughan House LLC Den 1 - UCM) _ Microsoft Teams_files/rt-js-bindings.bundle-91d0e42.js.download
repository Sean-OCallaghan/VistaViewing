!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("@skype/rt-js-bindings",[],t):"object"==typeof exports?exports["@skype/rt-js-bindings"]=t():e["@skype/rt-js-bindings"]=t()}(window,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(t){return e[t]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,n){"use strict";function r(e,t){var n=0;return e.replace(/%[dixs%]/g,function(e){var r=0;if("%"!==e[r++])return"";var o=e[r++];return"%"===o?"%":"s"===o?t[n++]:"d"===o||"i"===o?t[n++]:"x"===o?t[n++].toString(16):e})}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=10]="Trace",e[e.Debug6=16]="Debug6",e[e.Debug5=18]="Debug5",e[e.Debug4=20]="Debug4",e[e.Debug3=30]="Debug3",e[e.Debug2=40]="Debug2",e[e.Debug1=50]="Debug1",e[e.Warning=60]="Warning",e[e.Error=70]="Error",e[e.Fatal=80]="Fatal",e[e.MetaData=90]="MetaData"}(t.LogLevel||(t.LogLevel={})),function(e){e[e.UseDefault=0]="UseDefault",e[e.Compress=1]="Compress",e[e.Disabled=2]="Disabled"}(t.LogFileCompression||(t.LogFileCompression={})),function(e){e[e.Raw=0]="Raw",e[e.Base64=1]="Base64"}(t.LogFileEncoding||(t.LogFileEncoding={})),function(e){e[e.Unencrypted=0]="Unencrypted",e[e.Encrypted=1]="Encrypted"}(t.LogFileEncryption||(t.LogFileEncryption={})),function(e){e[e.PEM=0]="PEM",e[e.DER=1]="DER",e[e.BER=2]="BER"}(t.CertStoreFormat||(t.CertStoreFormat={})),function(e){e[e.InsertFront=8]="InsertFront"}(t.AppenderFlags||(t.AppenderFlags={})),t.vsprintf=r,t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(e,t)}},function(e,t,n){"use strict";function r(e){if(null===e)return-1;for(var t=0,n=e.length-1;n>=0;n--)t=37*t+e.charCodeAt(n)|0;var r="__auf_literal:";for(n=r.length-1;n>=0;n--)t=37*t+r.charCodeAt(n)|0;return t}function o(e,t){for(var n=t.name();n.length>0;){if(e[n])return e[n];var r=n.lastIndexOf(".");n=r<0?"":n.substr(0,r)}return e[""]?e[""]:l.LogLevel.Debug4}function i(e,t){var n=255;return t.forEach(function(t){var r=255;t.appender.levels()?r=Math.min(r,o(t.appender.levels(),e)):t.appender.receiveAll()||(r=Math.min(r,e.level())),n=Math.min(n,r)}),n}var s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a,l=n(0);!function(e){e[e.Unsafe=0]="Unsafe",e[e.Safe=1]="Safe",e[e.Inherited_Unsafe=2]="Inherited_Unsafe",e[e.Inherited_Safe=3]="Inherited_Safe",e[e.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(a||(a={}));var c,u=function(){function e(e,t){this._level=l.LogLevel.Debug4,this._threshold=255,this._safe=a.Inherited_Unsafe,this._name=e,t&&(this._level=t.level(),this._safe=t.safe()?a.Inherited_Safe:a.Inherited_Unsafe,this._extendedInfo=t.extendedInfo())}return e.prototype.name=function(){return this._name},e.prototype.safe=function(){return this._safe===a.Safe||this._safe===a.Inherited_Safe},e.prototype.safety=function(){return this._safe},e.prototype.setSafety=function(e){this._safe=e},e.prototype.description=function(){return this._desc},e.prototype.setDescription=function(e){this._desc=e},e.prototype.level=function(){return this._level},e.prototype.setLevel=function(e){c.setLevel(this,e)},e.prototype._setLevel=function(e){this._level=e},e.prototype._setThreshold=function(e){this._threshold=e},e.prototype.isEnabled=function(e){return this._threshold<=e},e.prototype.setExtendedInfo=function(e){this._extendedInfo=e},e.prototype.extendedInfo=function(){return this._extendedInfo},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Trace,r(e),e].concat(t))},e.prototype.debug6=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Debug6,r(e),e].concat(t))},e.prototype.debug5=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Debug5,r(e),e].concat(t))},e.prototype.debug4=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Debug4,r(e),e].concat(t))},e.prototype.debug3=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Debug3,r(e),e].concat(t))},e.prototype.debug2=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Debug2,r(e),e].concat(t))},e.prototype.debug1=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Debug1,r(e),e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Warning,r(e),e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Error,r(e),e].concat(t))},e.prototype.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.Fatal,r(e),e].concat(t))},e.prototype.meta=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,l.LogLevel.MetaData,r(e),e].concat(t))},e}(),f=function(){function e(){}return e.instance=function(){return c},e.levelToString=function(e){return e<=l.LogLevel.Trace?"TRACE":e<=l.LogLevel.Debug6?"DEBUG6":e<=l.LogLevel.Debug5?"DEBUG5":e<=l.LogLevel.Debug4?"DEBUG4":e<=l.LogLevel.Debug3?"DEBUG3":e<=l.LogLevel.Debug2?"DEBUG2":e<=l.LogLevel.Debug1?"DEBUG1":e<=l.LogLevel.Warning?"WARN":e<=l.LogLevel.Error?"ERROR":e<=l.LogLevel.Fatal?"FATAL":(l.LogLevel.MetaData,"META")},e.levelFromString=function(e){return this._levelFromString[e]||parseInt(e,10)},e}();f._levelFromString={TRACE:l.LogLevel.Trace,DEBUG6:l.LogLevel.Debug6,DEBUG5:l.LogLevel.Debug5,DEBUG4:l.LogLevel.Debug4,DEBUG3:l.LogLevel.Debug3,DEBUG2:l.LogLevel.Debug2,DEBUG1:l.LogLevel.Debug1,WARN:l.LogLevel.Warning,ERROR:l.LogLevel.Error,FATAL:l.LogLevel.Fatal,META:l.LogLevel.MetaData},t.LogFactory=f;var p=function(e){function t(){var t=e.call(this)||this;return t._nextId=0,t._appenders=[],t._components={},t._componentBlacklist=[],t._components[""]=new u("",null),t}return s(t,e),t.prototype.toHex=function(e){return(4294967296+e).toString(16).substr(-8)},t.prototype.addAppender=function(e,t){void 0===t&&(t=0);var n=this._nextId++;return t&l.AppenderFlags.InsertFront?this._appenders.unshift({appender:e,handle:n}):this._appenders.push({appender:e,handle:n}),this.recalcComponentThresholds(),n},t.prototype.removeAppender=function(e){for(var t=0;t<this._appenders.length;t++)if(this._appenders[t].handle===e){this._appenders.splice(t,1);break}this.recalcComponentThresholds()},t.prototype.log=function(e,t,n,r){for(var i=[],s=4;s<arguments.length;s++)i[s-4]=arguments[s];try{if(e.isEnabled(t)){var a={timestamp:(new Date).getTime(),component:e,level:t};this._appenders.forEach(function(s){(function(e,t,n){return!!e.appender.receiveAll()||(e.appender.levels()?n>=o(e.appender.levels(),t):n>=t.level())})(s,e,t)&&s.appender.log(a,n,r,i)})}}catch(e){}},t.prototype.parent=function(e){for(;;){var t=e.lastIndexOf(".");if(e=t>=0?e.substr(0,t):"",this._components[e])return this._components[e]}},t.prototype.children=function(e){var t=[];for(var n in this._components)this.parent(n).name()===e&&t.push(this._components[n]);return t},t.prototype.component=function(e){if(this._components[e])return this._components[e];var t=new u(e,this.parent(e));this._components[e]=t;var n=i(t,this._appenders);return t._setThreshold(n),t},t.prototype.rootComponent=function(){return this.component("")},t.prototype.setSafetyRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){e.safety()!==a.Inherited_Safe&&e.safety()!==a.Inherited_Unsafe||(e.setSafety(t),n.setSafetyRecursive(e.name(),t))})},t.prototype.declareComponentSafe=function(e,t){var n=this.component(e);-1!==this._componentBlacklist.indexOf(n.name())?n.setSafety(a.Blacklisted_Unsafe):n.setSafety(t?a.Safe:a.Unsafe),this.setSafetyRecursive(e,t?a.Inherited_Safe:a.Inherited_Unsafe)},t.prototype.declareComponentDescription=function(e,t){this.component(e).setDescription(t)},t.prototype.setExtendedInfoRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){void 0===e.extendedInfo()&&(e.setExtendedInfo(t),n.setExtendedInfoRecursive(e.name(),t))})},t.prototype.declareComponentExtendedInfo=function(e,t){var n=this.component(e);n.setExtendedInfo(t),this.setExtendedInfoRecursive(n.name(),t)},t.prototype.recalcComponentThresholds=function(){for(var e in this._components){var t=this._components[e],n=i(t,this._appenders);t._setThreshold(n)}},t.prototype.setLevel=function(e,t){if(""===e.name())for(var n in this._components){(s=this._components[n])._setLevel(t);var r=i(s,this._appenders);s._setThreshold(r)}else{var o=e.name()+".";e._setLevel(t),r=i(e,this._appenders);for(var n in e._setThreshold(r),this._components){var s;if((s=this._components[n]).name().substr(0,o.length)===o){s._setLevel(t);var a=i(s,this._appenders);s._setThreshold(a)}}}},t.prototype.setComponentBlacklist=function(e){for(var t in this._componentBlacklist=e,this._components){var n=this._components[t];-1!==this._componentBlacklist.indexOf(n.name())&&n.setSafety(a.Blacklisted_Unsafe)}},t}(f);c=new p},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e){return(4294967296+e).toString(16).substr(-8)}function o(e,t){return(1e12+e).toString(10).substr(-t)}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var s,a=n(0),l=n(1),c=function(){function e(e){this._formatter=e||new u}return e.prototype.formatter=function(){return this._formatter},e.prototype.receiveAll=function(){return!1},e.prototype.levels=function(){return null},e}();t.AbstractLogAppender=c,function(e){e[e.Timestamp=1]="Timestamp",e[e.Component=4]="Component",e[e.Level=8]="Level",e[e.FullDate=32]="FullDate",e[e.LogId=64]="LogId"}(s=t.SLF_Flags||(t.SLF_Flags={}));var u=function(){function e(e){void 0===e&&(e=4294967295),this._flags=e}return e.prototype.format=function(e,t,n,i){var c="";if(this._flags&s.FullDate)c+=new Date(e.timestamp).toISOString()+" ";else if(this._flags&s.Timestamp){var u=new Date(e.timestamp);c+=o(u.getHours(),2)+":"+o(u.getMinutes(),2)+":"+o(u.getSeconds(),2)+"."+o(u.getMilliseconds(),2)+" "}return this._flags&s.LogId&&(c+="[#"+r(t)+"-"+(e.component.safe()?"S":"u")+"] "),this._flags&s.Level&&(c+="["+l.LogFactory.levelToString(e.level)+"] "),this._flags&s.Component&&(c+="["+e.component.name()+"] "),n||""===n?c+a.vsprintf(n,i):c+r(t)+": "+i.join(" ")},e}();t.StandardLogFormatter=u;var f=console,p=console.log||function(){},h=console.info||p,d=console.warn||h,g=console.error||d,v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.log=function(e,t,n,r){r=r.slice(0);var o=e.level<=a.LogLevel.Debug3?p:e.level<=a.LogLevel.Debug1?h:e.level<=a.LogLevel.Warning?d:g;if(-1===t){var i=this.formatter().format(e,t,"",[]);"string"==typeof r[0]&&(i+=r.shift()),o.apply(f,[i].concat(r))}else{for(var s=void 0,l=[];s=n.match(/\s*%@\s*$/);)n=n.substr(0,n.length-s[0].length),l.unshift(r.pop());i=this.formatter().format(e,t,n,r),o.apply(f,[i].concat(l))}},t}(c);t.ConsoleAppender=v;var _=function(){function e(e){this._chained=e}return e.prototype.log=function(e,t,n,r){this._chained.log(e,t,n,r)},e.prototype.receiveAll=function(){return this._chained.receiveAll()},e.prototype.levels=function(){return this._chained.levels()},e}();t.ChainedLogAppender=_;var m=function(e){function t(t,n){var r=e.call(this,t)||this;return r._levels=n,r}return i(t,e),t.prototype.levels=function(){return this._levels},t}(_);t.wrapAppenderWithLogLevels=function(e,t){return new m(e,t)}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(0)),r(n(1)),r(n(5)),r(n(3)),r(n(10))},function(e,t,n){"use strict";function r(e,t){var n=[];for(var r in e)n.push(t(r,e[r]));return n}function o(e,t,n){if(null==e)return null==t||0===t.length;if(null==t)return null==e||0===e.length;if(e.length===t.length){for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}return!1}function i(e,t){return null==e?null==t:null==t?null==e:e.arg===t.arg&&e.op===t.op&&e.value===t.value}function s(e,t){return null==e?null==t||0===t.logId:null==t?null==e||0===e.logId:e.logId===t.logId&&e.name===t.name&&o(e.matchers,t.matchers,i)}function a(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.parsedLevel===t.level}function l(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.level===t.level}function c(e){for(var t=[],n=0;n<e.length;n++)"string"==typeof e[n]||"number"==typeof e[n]?t.push(e[n]):t.push(JSON.stringify(e[n]));return t}function u(e){return"Native"===e||"JavaScript"===e||"Mixed"===e}var f=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var p=n(6),h=n(1),d=n(0),g=n(3),v=h.LogFactory.instance().component("RootToolsManager");h.LogFactory.instance().declareComponentSafe("RootToolsManager",!0);var _;!function(e){e[e.InternalBuild=0]="InternalBuild",e[e.PublicBuild=1]="PublicBuild"}(_=t.BuildType||(t.BuildType={}));var m=_.InternalBuild;t.setBuildType=function(e){var t=m;return m=e,t};var y=function(e){function t(t,n,r){var o=e.call(this)||this;return o._unmetConditions=[],o._rtMan=t,o._triggerCallback=n,o._ecsConfig=r,o.resetConditions(),o}return f(t,e),t.prototype.config=function(){return this._ecsConfig},t.prototype.configEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.mutualSubmissionType===e.mutualSubmissionType&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&this._ecsConfig.experimentTarget===e.experimentTarget&&s(this._ecsConfig.resetCondition,e.resetCondition)&&o(this._ecsConfig.conditions,e.conditions,s)&&o(this._ecsConfig.filters,e.filters,l)},t.prototype.nativeConfigEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&s(this._ecsConfig.resetCondition,e.resetCondition)&&o(this._ecsConfig.conditions,e.conditions,s)&&o(this._ecsConfig.filters,e.filters,a)},t.prototype.needReset=function(e){return!this.configEquals(e)},t.prototype.resetConditions=function(){this._unmetConditions=[];for(var e=0;e<this._ecsConfig.conditions.length;e++)this._unmetConditions.push(e)},t.prototype.matcherMatches=function(e,t){if(e.arg>=t.length)return!1;var n=t[e.arg],r="string"==typeof n?e.value:parseInt(e.value,10);return"="===e.op||"=="===e.op?n===r:"!="===e.op?n!==r:"<"===e.op?n<r:"<="===e.op?n<=r:">"===e.op?n>r:">="===e.op?n>=r:"CONTAINS"===e.op.toUpperCase()&&(""+n).indexOf(e.value)>=0},t.prototype.conditionMatches=function(e,t,n){if(t!==e.logId)return!1;if(e.matchers)for(var r=0;r<e.matchers.length;r++)if(!this.matcherMatches(e.matchers[r],n))return!1;return!0},t.prototype.log=function(e,t,n,r){if(0!==this._unmetConditions.length&&e.component!==v){var o=this._ecsConfig;o.resetCondition&&this.conditionMatches(o.resetCondition,t,r)&&(v.debug4("LogTrigger %s: resetCondition met",o.name),this.resetConditions());for(var i=0;i<this._unmetConditions.length;i++){var s=this._unmetConditions[i];if(this.conditionMatches(o.conditions[s],t,r)){v.debug4("LogTrigger %s: condition %s met",o.name,o.conditions[s].name),this._unmetConditions.splice(i,1);break}}0===this._unmetConditions.length&&(v.debug1("LogTrigger %s has triggered, trying to send the log",o.name),this._triggerCallback.call(this._rtMan,o),o.reenableAfterTriggering&&this.resetConditions())}},t.prototype.receiveAll=function(){return!0},t}(g.AbstractLogAppender),b=function(e){function t(t,n,r){var o=e.call(this)||this;return o._circularBuffer=[],o._circularBufferMaxSize=0,o._onBufferOverflow=null,o._circularBuffer=[],o._circularBufferMaxSize=n,o._includeUnsafe=t,o._onBufferOverflow=r||function(){return o._circularBuffer.shift()},o}return f(t,e),t.prototype.log=function(e,t,n,r){if((this._includeUnsafe||e.component.safe())&&!(this._circularBuffer.length>this._circularBufferMaxSize)){var o={md:e,logId:t,messages:c(r)};this._circularBuffer.push(o),this._circularBuffer.length>this._circularBufferMaxSize&&this._onBufferOverflow()}},t.prototype.visitReverseOrder=function(e){for(var t=this._circularBuffer.length-1;t>=0;t--){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.visitForwardOrder=function(e){for(var t=0;t<this._circularBuffer.length;t++){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.needReset=function(e,t){return e!==this._includeUnsafe||t!==this._circularBufferMaxSize},t.prototype.dumpLogBuffer=function(e,t,n){var r=this,o=new L(e.reverse),i=e.filter.map(function(e){return{component:"root"===e.component?"":e.component,parsedLevel:e.level}}),s=n||{matchedLines:0,totalLines:0};return(e.reverse?this.visitReverseOrder:this.visitForwardOrder).apply(this,[function(e,n,a){return s.totalLines++,r.filterMatches(e,n,a,i)&&(s.matchedLines++,o.log(e.component,e.timestamp,e.level,n,a)),!t||o._data.length<t}]),o.close(),o.data()},t.prototype.filterMatches=function(e,t,n,r){for(var o=0;o<r.length;o++)if((""===r[o].component||e.component.name()===r[o].component||e.component.name().substr(0,r[o].component.length)===r[o].component&&"."===e.component.name().charAt(r[o].component.length))&&e.level>=r[o].parsedLevel)return!0;return!1},t.prototype.clear=function(){this._circularBuffer=[]},t.prototype.size=function(){return this._circularBuffer.length},t.prototype.empty=function(){return 0===this.size()},t.prototype.capacity=function(){return this._circularBufferMaxSize},t}(g.AbstractLogAppender);t.CircularBuffer=b;var L=function(){function e(e){this._reverse=e,this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2"+String.fromCharCode(33)+String.fromCharCode(32),this._data+=e?String.fromCharCode(34):String.fromCharCode(32),this._data+=String.fromCharCode(32)}return e.prototype._add8=function(e){if(this._pending.push(255&e),3===this._pending.length){var t=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),n=this._base64chars[t>>18&63]+this._base64chars[t>>12&63]+this._base64chars[t>>6&63]+this._base64chars[t>>0&63];this._data+=n,this._pending=[]}},e.prototype._add16=function(e){this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add32=function(e){this._add8(e>>24&255),this._add8(e>>16&255),this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add64=function(e){this._add32(e/4294967296|0),this._add32(0|e)},e.prototype._addS=function(e){for(var t=0;t<e.length;t++)this._add8(e.charCodeAt(t));this._add8(0)},e.prototype._close=function(){for(;this._pending.length;)this._add8(0)},e.prototype.log=function(e,t,n,r,o){var i=this._components[e.name()];i||(i=++this._componentCount,this._components[e.name()]=i,this._add8(2),this._add16(i),this._addS(e.name()),this._addS(""),this._addS(""),this._add8(e.safe()?1:0));var s=128;this._first&&(s|=2);var a=t-this._lastts;this._lastts=t,a>-128&&a<128&&(s|=1),this._add8(s),1&s?this._add8(a):this._add64(1e3*t),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(i),this._add8(n),this._add32(r),this._add8(o.length);for(var l=0;l<o.length;l++)this._add8(8),this._addS(""+o[l]);this._first=!1},e.prototype.close=function(){this._add8(7),this._close()},e.prototype.data=function(){return this._data},e.prototype.empty=function(){return this._first},e}(),T=function(e){function t(t,n){var r=e.call(this)||this;return r._capacity=t,r._onBufferOverflow=n,r._outputFormatter=new L(!1),r._linesStored=0,r}return f(t,e),t.prototype.log=function(e,t,n,r){this._outputFormatter.log(e.component,e.timestamp,e.level,t,c(r)),++this._linesStored>this._capacity&&this._onBufferOverflow()},t.prototype.dumpAndReset=function(){if(this._outputFormatter.empty())return"";this._outputFormatter.close();var e=this._outputFormatter.data();return this.clearBuffer(),e},t.prototype.empty=function(){return this._outputFormatter.empty()},t.prototype.clearBuffer=function(){this._outputFormatter=new L(!1),this._linesStored=0},t.prototype.capacity=function(){return this._capacity},t.prototype.size=function(){return this._linesStored},t}(g.AbstractLogAppender);t.DumperBuffer=T;var C=function(){function e(){this._maxUploadSize=0,this._jsToNativeBuffer=null,this._jsToNativeBufferHandle=null,this._jsToNativeFlushTimer=null,this._jsToNativeFlushInterval=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:d.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed",this._BRBCallback=null}return e.prototype.setDelegate=function(e){this._glue=e,this.registerListeners()},e.prototype.isDelegateSet=function(){return null!=this._glue},e.prototype.setNativeFunctions=function(e){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=e,this._native&&this._native.log_config.addLogTriggerListener(this)},e.prototype.applyLogLevels=function(){var e={};for(var t in this._localLogLevels)e[t]=this._localLogLevels[t];e[""]=e.root||d.LogLevel.Debug4,delete e.root;var n=r(e,function(e,t){return{component:e,level:t}});n.sort(function(e,t){return e.component.length-t.component.length}),n.forEach(function(e){return h.LogFactory.instance().component(e.component).setLevel(e.level)}),this._native&&this._native.log_config.setLogLevelConfig(n)},e.prototype.setLocalLogLevelConfig=function(e){this._localLogLevels=e,this.applyLogLevels()},e.prototype.parseMatcher=function(e){return null==e||null==e.arg||null==e.op||null==e.value?null:{arg:e.arg,op:e.op,value:e.value}},e.prototype.parseCondition=function(e){if(null==e||null==e.logId)return null;if(e.matchers&&!(e.matchers instanceof Array))return null;var t={name:e.name||function(e){return(4294967296+e).toString(16).substr(-8)}(e.logId),logId:e.logId,matchers:[]};if(e.matchers&&e.matchers.length)for(var n=0,r=e.matchers;n<r.length;n++){var o=r[n],i=this.parseMatcher(o);i&&t.matchers.push(i)}return t},e.prototype.parseFilter=function(e){return null==e||null==e.component||0===e.component.length?null:{component:e.component,level:e.level,parsedLevel:h.LogFactory.levelFromString(e.level)}},e.prototype.parseConfig=function(e,t,n){if(null==e)return null;if(!(e.conditions instanceof Array)||0==e.conditions.length)return null;if(!(e.filters instanceof Array)||0==e.filters.length)return null;if(e.resetCondition&&!this.parseCondition(e.resetCondition))return null;for(var r={name:e.name||t+"->"+n,ecsNs:t,reenableAfterTriggering:e.reenableAfterTriggering||!1,mutualSubmissionType:e.mutualSubmissionType||"",includeUnsafe:m!==_.PublicBuild&&(e.includeUnsafe||!1),experimentTarget:u(e.experimentTarget)&&e.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==e.resetCondition?e.resetCondition:this.parseCondition(e.resetCondition),filters:[]},o=0,i=e.conditions;o<i.length;o++){var s=i[o],a=this.parseCondition(s);a&&r.conditions.push(a)}for(var l=0,c=e.filters;l<c.length;l++){var f=c[l],p=this.parseFilter(f);p&&r.filters.push(p)}return 0===r.conditions.length?null:r},e.prototype.isExperimentListed=function(e,t,n,r){return!!e&&(!(!r||!e.some(function(e){return"*"===e.namespace}))||e.some(function(e){return e.namespace===t&&(e.experiment===n||"*"==e.experiment)}))},e.prototype.isExperimentAllowed=function(e,t,n){return!this.isExperimentListed(e.blacklist,t,n,!0)||this.isExperimentListed(e.whitelist,t,n,!1)},e.prototype.findTrigger=function(e,t){for(var n in e)if(e[n].configEquals(t))return n;return null},e.prototype.findTriggerByNativeConfig=function(e,t){for(var n in e)if(e[n].nativeConfigEquals(t))return n;return null},e.prototype.OnEcsChange=function(){var e=this;return null==this._glue?p.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then(function(t){v.debug4("Reloading ULBaseline config - new config: %@",t),t||(v.warn("No ULBaseline config"),t={}),e._maxUploadSize=t.logUpload&&t.logUpload.maxSize||1024;var n=[],o=e._triggers;e._triggers={};var i=(t.logUpload&&t.logUpload.maxSize||1024)/100,s=t.circularBuffer&&t.circularBuffer.enabled,a=t.circularBuffer&&t.circularBuffer.buffers||e._defaultBuffers,l=t.circularBuffer&&t.circularBuffer.storeUnsafe;e._defaultExperimentTarget=u(t.defaultExperimentTarget)&&t.defaultExperimentTarget||"Mixed";var c=t.killswitch||e._defaultKillswitch,f=t.blacklists||e._defaultBlacklists;f.component.length>0&&h.LogFactory.instance().setComponentBlacklist(f.component);var _={};(t.componentLevels||[]).forEach(function(e){return _[e.component]=e.level}),function e(t,n,r){return n<t.length?r(t[n]).then(function(){return e(t,n+1,r)}):p.Resolved()}(t.configPaths||[],0,function(t){return e._glue.fetchEcsConfig(t.ns,t.key).then(function(r){var i=r instanceof Array?r:[r];v.debug4("Reloading ECS config for %s->%s - new config: %@",t.ns,t.key,i);for(var a=0,u=i;a<u.length;a++){var f=u[a];if(null!=f){var p=e.parseConfig(f,t.ns,t.key);if(null!=p)if("JavaScript"===p.experimentTarget||"Mixed"===p.experimentTarget)if(v.debug2("Parsed ECS config for %s->%s - %@",t.ns,t.key,p),e.isExperimentAllowed(c,t.ns,p.name)){v.debug2("Allowing %s->%s:%s according to killswitch",t.ns,t.key,p.name),s=!0;var h=e.findTrigger(o,p);null!=h?(v.debug2("Triggers updated, keeping trigger %s",p.name),e._triggers[h]=o[h],delete o[h]):n.push(p),p.filters&&p.filters.forEach(function(e){return _[e.component]=Math.min(_[e.component]||255,e.parsedLevel)}),p.includeUnsafe&&(l=!0)}else v.debug2("Disallowing %s->%s according to killswitch",t.ns,t.key);else v.debug4("Skipping %s->%s, targeted for %s",t.ns,t.key,p);else v.error("Failed to parse ECS config for %s->%s",t.ns,t.key)}}})}).always(function(){for(var t in e.applyLogLevels(),o)v.debug2("Triggers updated, removing trigger %s",o[t].config().name),h.LogFactory.instance().removeAppender(+t);if(n.forEach(function(t){v.debug2("Triggers updated, adding trigger %s",t.name);var n=new y(e,e._triggered,t),r=h.LogFactory.instance().addAppender(n);e._triggers[String(r)]=n}),_[""]=_.root||d.LogLevel.Debug4,delete _.root,!e._circularBuffer||s&&!e._circularBuffer.needReset(l,i)?e._circularBuffer&&(Object.keys(o).length>0||n.length>0?(v.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),h.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBufferHandle=null):v.debug2("Buffer updated, no change")):(v.debug2("Buffer updated, removing existing buffer"),h.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBuffer=null,e._circularBufferHandle=null),s&&(e._circularBuffer||(v.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",l,i),e._circularBuffer=new b(l,i)),null==e._circularBufferHandle&&(v.debug2("Creating log level wrapper"),e._circularBufferHandle=h.LogFactory.instance().addAppender(g.wrapAppenderWithLogLevels(e._circularBuffer,_),d.AppenderFlags.InsertFront))),e._native){var c=r(_,function(e,t){return{component:e,level:t}});c.sort(function(e,t){return e.component.length-t.component.length}),e._native.log_config.setLogBufferConfig(s,{storeUnsafe:l,buffers:a},c);var u=[];for(var f in e._triggers){var p=e._triggers[f].config();u.push({name:p.name,ecsNs:p.ecsNs,conditions:p.conditions,resetCondition:p.resetCondition,includeUnsafe:p.includeUnsafe,reenableAfterTriggering:p.reenableAfterTriggering,filters:p.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),dumpFile:!1,metadata:{}})}e._native.log_config.setLogTriggerConfig(u,{})}})})},e.prototype._send=function(e,t){null!=this._glue&&(this._glue.sendTelemetry("638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104",{logTriggerName:e.name,logEcsNs:e.ecsNs,logdata:t}),v.debug4("LogSender::send, sent %d bytes",t.length))},e.prototype.triggered=function(e,t){},e.prototype.triggeredPartially=function(e,t,n,r,o){var i=this.findTriggerByNativeConfig(this._triggers,e);if(i){var s={level:t.level,component:h.LogFactory.instance().component(t.component),timestamp:t.timestamp};this._triggers[i].log(s,n,r,o)}},e.prototype.reset=function(e){var t=this.findTriggerByNativeConfig(this._triggers,e);t&&this._triggers[t].resetConditions()},e.prototype.dumpLogBuffer=function(e,t){if(this._circularBuffer){var n={matchedLines:0,totalLines:0},r=this._circularBuffer.dumpLogBuffer(e,this._maxUploadSize,n);if(v.debug4("dumpLogBuffer: dumped %d of %d lines, size of payload: %d",n.matchedLines,n.totalLines,null!=r?r.length:0),this._native){var o=p.Defer();return this._native.log_config.mergeAndDumpLogBuffer(r,e,t,function(e){return o.resolve(e)}),o.promise()}return p.Resolved(r)}return v.warn("dumpLogBuffer: no log buffer enabled"),p.Rejected()},e.prototype._triggered=function(e){var t=this,n={compression:d.LogFileCompression.Compress,encoding:d.LogFileEncoding.Base64,encryption:d.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},r={includeUnsafe:e.includeUnsafe,filter:e.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),reverse:!0};this.dumpLogBuffer(r,n).then(function(n){return t._send(e,n)})},e.prototype.sendBRBEvent=function(e){try{if(v.debug2("sendBRBEvent %s",JSON.stringify(e)),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var t={eventType:"uploadBRB",mutualSubmissionType:"call",payload:e};this._glue.sendLoggingEventToNative(JSON.stringify(t),"")}}catch(e){v.error("sendBRBEvent %s: %s",e.name,e.message)}},e.prototype.setBRBCallback=function(e){v.debug2("setBRBCallback"),null!=this._glue?"function"==typeof this._glue.setNativeLoggingEventCallback?this._BRBCallback=e:v.warn("setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method"):v.warn("setBRBCallback: RootToolsManagerDelegate is not set")},e.prototype.registerListeners=function(){var e=this;null!=this._glue&&"function"==typeof this._glue.setNativeLoggingEventCallback?this._glue.setNativeLoggingEventCallback(function(t,n){return e.handleNativeLoggingEvent(t,n)}):v.warn("registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method")},e.prototype.handleNativeLoggingEvent=function(e,t){try{v.debug2("Native Log event message: %s aux: %s",e,t);var n=JSON.parse(e);if(n.eventType&&"uploadBRB"===n.eventType){if("function"!=typeof this._BRBCallback)return void v.warn("BRBCallback not set, ignoring native event");v.debug4("Sending BRB callback: %@",n.payload),this._BRBCallback(n.payload)}else n.eventType&&"jsLogFileConfiguration"===n.eventType&&this.handleLogFileConfigEvent(n)}catch(e){v.error("handleNativeLoggingEvent %s: %s",e.name,e.message)}},e.prototype.handleLogFileConfigEvent=function(e){if(e.payload){var t=e.payload;if(t.enabled){if(t.chunkSize&&t.flushInterval){var n=t.chunkSize,r=t.flushInterval;this.startJsToNativeLogging(n,r)}}else this.flushDisableJsToNativeLogging()}},e.prototype.logExternalForDDL=function(e,t){try{if(v.debug2("logExternalForDDL %s %s",e,t),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var n={eventType:"logInSClog",payload:{message:e,parameters:t}};this._glue.sendLoggingEventToNative(JSON.stringify(n),"")}else v.warn("ignoring logExternalForDDL, delegate misconfigured")}catch(e){v.error("logExternalForDDL %s: %s",e.name,e.message)}},e.prototype.startJsToNativeLogging=function(e,t){var n=this;if(this._jsToNativeBuffer){if(this._jsToNativeBuffer.capacity()===e&&this._jsToNativeFlushInterval===t)return void v.debug1("Same JS2Native settings received - doing nothing");v.debug1("Reapplying js to native settings"),this.flushDisableJsToNativeLogging()}this._jsToNativeBuffer=new T(e,function(){n.onJsToNativeBufferReady(n._jsToNativeBuffer)}),this.setJsToNativeFlushTimeout(t),this._jsToNativeFlushInterval=t,this._jsToNativeBufferHandle=h.LogFactory.instance().addAppender(this._jsToNativeBuffer)},e.prototype.flushDisableJsToNativeLogging=function(){this._jsToNativeBuffer&&this.onJsToNativeBufferReady(this._jsToNativeBuffer),this.plainDisableJsToNativeLogging()},e.prototype.plainDisableJsToNativeLogging=function(){this.clearJsToNativeFlushTimeout(),this._jsToNativeBufferHandle&&(h.LogFactory.instance().removeAppender(this._jsToNativeBufferHandle),this._jsToNativeBufferHandle=0,this._jsToNativeBuffer=null,v.debug1("Disabling forwarding JS logs to native"))},e.prototype.onJsToNativeBufferReady=function(e){null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative?(this.clearJsToNativeFlushTimeout(),this.dumpJsToNativeBuffer(e),this.setJsToNativeFlushTimeout(this._jsToNativeFlushInterval)):this.plainDisableJsToNativeLogging()},e.prototype.dumpJsToNativeBuffer=function(e){if(!e.empty()){var t=e.dumpAndReset();this._glue.sendLoggingEventToNative(JSON.stringify({eventType:"writeLogData"}),t)}},e.prototype.clearJsToNativeFlushTimeout=function(){this._jsToNativeFlushTimer&&(clearTimeout(this._jsToNativeFlushTimer),this._jsToNativeFlushTimer=null)},e.prototype.setJsToNativeFlushTimeout=function(e){var t=this;!this._jsToNativeFlushTimer&&e&&(this._jsToNativeFlushTimer=setTimeout(function(){t._jsToNativeFlushTimer=null,t.onJsToNativeBufferReady(t._jsToNativeBuffer)},e))},e.prototype.stopAsyncOperations=function(){this.flushDisableJsToNativeLogging()},e}();t.RootToolsManager=new C},function(e,t,n){"use strict";(function(e){function n(e){return null!=e&&"function"==typeof e.then}function r(e){return null!=e&&"function"==typeof e.cancel}function o(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}function i(t){f.push(t),1===f.length&&(p?e(s):setTimeout(s,0))}function s(){var e=f;f=[];for(var t=0;t<e.length;t++)e[t]()}function a(){return new u.SyncTask}function l(e){return(new u.SyncTask).resolve(e).promise()}function c(e){var t=a(),o=!1;return t.onCancel(function(t){e.forEach(function(e){r(e)&&u.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){o||(o=!0,t.resolve(e))},function(e){o||(o=!0,t.reject(e))}):o||(o=!0,t.resolve(e))}),t.promise()}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=a();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var u,f=[],p=void 0!==e;t.asyncCallback=i,function(e){var s=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,o=new e;return o.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)}),t.task=o,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:o._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),o.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?i(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var i=this;t.successFunc?o(function(){var o=t.successFunc(i._storedResolution);r(o)&&(t.wasCanceled?e.cancelOtherInternal(o,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(o,t)})),n(o)?o.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(o)},function(e){i._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?i(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var i=this;t.failFunc?o(function(){var o=t.failFunc(i._storedErrResolution);r(o)&&(t.wasCanceled?e.cancelOtherInternal(o,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(o,t)})),n(o)?o.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(o)},function(e){i._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=s}(u||(u={})),t.all=function(e){if(0===e.length)return l([]);var t,o=a(),i=e.length,s=Array(e.length);o.onCancel(function(t){e.forEach(function(e){r(e)&&u.SyncTask.cancelOtherInternal(e,t)})});var c=function(){0==--i&&(void 0!==t?o.reject(t):o.resolve(s))};return e.forEach(function(e,r){n(e)?e.then(function(e){s[r]=e,c()},function(e){void 0===t&&(t=void 0===e||e),c()}):(s[r]=e,c())}),o.promise()},t.Defer=a,t.Resolved=l,t.Rejected=function(e){return(new u.SyncTask).reject(e).promise()},t.race=c,t.raceTimer=function(e,t){var n=a(),r=setTimeout(function(){n.resolve({timedOut:!0})},t);return c([e.then(function(e){return clearTimeout(r),{timedOut:!1,result:e}}),n.promise()])}}).call(this,n(7).setImmediate)},function(e,t,n){(function(e){function r(e,t){this._id=e,this._clearFn=t}var o=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(8),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(2))},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){delete a[e]}function o(e){if(l)setTimeout(o,0,e);else{var t=a[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{r(e),l=!1}}}}if(!e.setImmediate){var i,s=1,a={},l=!1,c=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){o(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),i=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},i=function(t){e.port2.postMessage(t)}}():c&&"onreadystatechange"in c.createElement("script")?function(){var e=c.documentElement;i=function(t){var n=c.createElement("script");n.onreadystatechange=function(){o(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():i=function(e){setTimeout(o,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return a[s]=r,i(s),s++},u.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(2),n(9))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(){d&&p&&(d=!1,p.length?h=p.concat(h):g=-1,h.length&&s())}function s(){if(!d){var e=o(i);d=!0;for(var t=h.length;t;){for(p=h,h=[];++g<t;)p&&p[g].run();g=-1,t=h.length}p=null,d=!1,function(e){if(u===clearTimeout)return clearTimeout(e);if((u===r||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}(e)}}function a(e,t){this.fun=e,this.array=t}function l(){}var c,u,f=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{u="function"==typeof clearTimeout?clearTimeout:r}catch(e){u=r}}();var p,h=[],d=!1,g=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new a(e,t)),1!==h.length||d||o(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(e){return e},i=!0,s=o,a={},l=0,c=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.InternalSkype=48]="InternalSkype"}(r||(r={}));var u=[r.Thread,r.InternalSkype,r.Bot];t.enableAnonymization=function(e){i=e},t.useTagger=function(e){s=e||o},function(e){function t(e){return i?e?a[e]||function(e){return a[e]="u"+ ++l}(e):null:e}e.UserName=function(e){var n=t(e);return s(n)},e.Mri=function(e){var n,r=e.match(c);if(r){var o=Number(r[1]),i=r[2];n=-1!=u.indexOf(o)?e:o+":"+t(i)}else n=t(e);return s(n)},e.Omit=function(e){var t;return t=i?"number"==typeof e?19229:"string"==typeof e?e.charAt(0)+"...":null:e,s(t)}}(t.pii||(t.pii={}))}])});